(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))o(s);new MutationObserver(s=>{for(const t of s)if(t.type==="childList")for(const a of t.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&o(a)}).observe(document,{childList:!0,subtree:!0});function l(s){const t={};return s.integrity&&(t.integrity=s.integrity),s.referrerPolicy&&(t.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?t.credentials="include":s.crossOrigin==="anonymous"?t.credentials="omit":t.credentials="same-origin",t}function o(s){if(s.ep)return;s.ep=!0;const t=l(s);fetch(s.href,t)}})();let i,m="",d="general",h=null,f=null,u=[];const p=document.getElementById("chat"),r=document.getElementById("msg"),v=document.getElementById("chat-header");window.onload=()=>{const e=localStorage.getItem("chatUsername");if(e){const n=document.getElementById("username");n&&(n.value=e),I()}};function S(e){const n=document.getElementById("auth-user").value.trim(),l=document.getElementById("auth-pass").value.trim();if(!n||!l)return alert("Enter both username and password.");localStorage.setItem("tempUser",n),localStorage.setItem("tempPass",l);const o=`ws://${window.location.host}`;i=new WebSocket(o),i.onopen=()=>{i.send(JSON.stringify({type:e,user:n,pass:l}))},i.onmessage=async s=>{const t=s.data instanceof Blob?await s.data.text():s.data,a=JSON.parse(t);if(a.type==="auth_success"){m=a.user,localStorage.setItem("chatUsername",m);const c=document.getElementById("login-screen");c&&(c.style.display="none"),i.send(JSON.stringify({type:"join",channel:d}))}else if(a.type==="auth_error"){const c=document.getElementById("auth-error");c&&(c.innerText=a.msg)}else if(a.type==="channels")u=a.channels,y(u);else if(a.type==="channelCreated")E(a.name);else if(a.type==="channelDeleted")d===a.name&&(d=u.find(c=>c!==a.name)||"general",v.innerText=`# ${d}`,r.placeholder=`Message #${d}...`),u=u.filter(c=>c!==a.name),y(u);else if(a.type==="history")p.innerHTML="",a.messages.forEach(c=>g(c));else if(a.type==="message")g(a);else if(a.type==="updateLikes"){const c=document.getElementById("like-"+a.id);c&&(c.innerText=`❤️ ${a.likes}`)}}}function C(){localStorage.clear(),location.reload()}function M(){const e=document.getElementById("new-password").value.trim();if(!e)return alert("Enter a new password!");i.send(JSON.stringify({type:"change_password",user:m,newPass:e})),localStorage.setItem("chatPass",e);const n=document.getElementById("settings-modal");n&&(n.style.display="none")}function T(){const e=new(window.AudioContext||window.webkitAudioContext),n=e.createOscillator();n.connect(e.destination),n.frequency.setValueAtTime(800,e.currentTime),n.start(),n.stop(e.currentTime+.15)}function I(){if(m=document.getElementById("username").value.trim(),!m)return alert("Please enter a username!");localStorage.setItem("chatUsername",m);const n=document.getElementById("login-screen");n&&(n.style.display="none");const l=`ws://${window.location.host}`;i=new WebSocket(l),i.onopen=()=>{i.send(JSON.stringify({type:"join",channel:d}))},i.onmessage=async o=>{const s=o.data instanceof Blob?await o.data.text():o.data,t=JSON.parse(s);if(t.type==="channels")u=t.channels,y(u);else if(t.type==="channelCreated")E(t.name);else if(t.type==="channelDeleted")d===t.name&&(d=u.find(a=>a!==t.name)||"general",v.innerText=`# ${d}`,r.placeholder=`Message #${d}...`),u=u.filter(a=>a!==t.name),y(u);else if(t.type==="history")p.innerHTML="",t.messages.forEach(a=>g(a));else if(t.type==="message")g(t);else if(t.type==="updateLikes"){const a=document.getElementById("like-"+t.id);a&&(a.innerText=`❤️ ${t.likes}`)}}}function E(e,n){d=e,document.querySelectorAll(".channel").forEach(l=>l.classList.remove("active")),n&&n.classList.add("active"),v.innerText=`# ${e}`,r.placeholder=`Message #${e}...`,i&&i.readyState===WebSocket.OPEN&&i.send(JSON.stringify({type:"join",channel:d}))}let w=null;function y(e){const n=document.getElementById("channels-list");n&&(n.innerHTML="",e.forEach(l=>{const o=document.createElement("div");o.className="channel"+(d===l?" active":"");const s=document.createElement("span");if(s.innerText=`# ${l}`,s.style.flex="1",s.onclick=function(){E(l,o)},o.appendChild(s),l!=="general"){const t=document.createElement("span");t.innerText="✕",t.className="channel-delete-btn",t.onclick=function(a){a.stopPropagation(),B(l)},o.appendChild(t)}n.appendChild(o)}))}function x(){const e=document.getElementById("new-channel-name");e&&(e.value="");const n=document.getElementById("add-channel-modal");n&&(n.style.display="flex")}function B(e){w=e;const n=document.getElementById("delete-channel-name");n&&(n.innerText=e);const l=document.getElementById("delete-channel-modal");l&&(l.style.display="flex")}function $(){w&&(i.send(JSON.stringify({type:"deleteChannel",name:w})),w=null);const e=document.getElementById("delete-channel-modal");e&&(e.style.display="none")}function O(){const e=document.getElementById("new-channel-name").value.trim();if(!e)return;i.send(JSON.stringify({type:"createChannel",name:e}));const n=document.getElementById("add-channel-modal");n&&(n.style.display="none")}function b(e){i.send(JSON.stringify({type:"deleteChannel",name:e}))}function g(e){let n;try{n=atob(e.text)}catch{n=e.text}let l=!1;n.includes(`@${m}`)&&(l=!0,e.user!==m&&T());let o="";e.media&&(e.mediaType==="video"?o=`<video src="${e.media}" class="msg-media" controls></video>`:o=`<img src="${e.media}" class="msg-media">`),p.innerHTML+=`
                <div class="msg-block ${l?"highlight":""}" id="msg-${e.id}">
                    <span class="msg-user">${e.user}</span>
                    <div class="msg-text">${n}</div>
                    ${o}
                    <div class="msg-actions">
                        <button class="action-btn" id="like-${e.id}" onclick="likeMessage('${e.id}')">❤️ ${e.likes}</button>
                        <button class="action-btn" onclick="replyTo('${e.user}')">↩️ Reply</button>
                    </div>
                </div>
            `,p.scrollTop=p.scrollHeight}function k(){const e=document.getElementById("new-username");e&&(e.value=m);const n=document.getElementById("settings-modal");n&&(n.style.display="flex")}function L(){const e=document.getElementById("new-username").value.trim();if(e){m=e,localStorage.setItem("chatUsername",m);const n=document.getElementById("settings-modal");n&&(n.style.display="none")}}function N(e){i&&i.send(JSON.stringify({type:"like",channel:d,messageId:e}))}function P(e){r.value=`@${e} `+r.value,r.focus()}document.getElementById("file-upload").addEventListener("change",function(){const e=this.files?.[0];if(!e)return;if(e.size>52428800)return alert("File is too large! Max limit is 50MB.");const n=new FileReader;n.onload=function(l){h=l.target?.result,f=e.type.startsWith("video")?"video":"image",r.placeholder=`[${f} attached] Add a message...`},n.readAsDataURL(e)});r.addEventListener("keypress",function(e){e.key==="Enter"&&(r.value.trim()||h)&&i&&(f==="video"&&(r.placeholder="Uploading video... please wait."),i.send(JSON.stringify({type:"message",channel:d,user:m,text:btoa(r.value),media:h,mediaType:f})),r.value="",r.placeholder=`Message #${d}...`,h=null,f=null,document.getElementById("file-upload").value="")});window.authenticate=S;window.signOut=C;window.changePassword=M;window.joinChat=I;window.switchChannel=E;window.renderChannels=y;window.openAddChannelModal=x;window.openDeleteChannelModal=B;window.confirmDeleteChannel=$;window.createChannel=O;window.deleteChannel=b;window.appendMessage=g;window.openSettings=k;window.saveSettings=L;window.likeMessage=N;window.replyTo=P;
