(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))o(t);new MutationObserver(t=>{for(const a of t)if(a.type==="childList")for(const l of a.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&o(l)}).observe(document,{childList:!0,subtree:!0});function s(t){const a={};return t.integrity&&(a.integrity=t.integrity),t.referrerPolicy&&(a.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?a.credentials="include":t.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function o(t){if(t.ep)return;t.ep=!0;const a=s(t);fetch(t.href,a)}})();let i,r="",d="general",h=null,f=null,m=[];const p=document.getElementById("chat"),u=document.getElementById("msg"),v=document.getElementById("chat-header");window.onload=()=>{const e=localStorage.getItem("chatUsername");if(e){r=e;const n=document.getElementById("login-screen");n&&(n.style.display="none"),I()}};function S(e){const n=document.getElementById("auth-user").value.trim(),s=document.getElementById("auth-pass").value.trim();if(!n||!s)return alert("Enter both username and password.");localStorage.setItem("tempUser",n),localStorage.setItem("tempPass",s);const o=`ws://${window.location.host}`;i=new WebSocket(o),i.onopen=()=>{i.send(JSON.stringify({type:e,user:n,pass:s}))},i.onmessage=async t=>{const a=t.data instanceof Blob?await t.data.text():t.data,l=JSON.parse(a);if(l.type==="auth_success"){r=l.user,localStorage.setItem("chatUsername",r);const c=document.getElementById("login-screen");c&&(c.style.display="none"),i.send(JSON.stringify({type:"join",channel:d}))}else if(l.type==="auth_error"){const c=document.getElementById("auth-error");c&&(c.innerText=l.msg)}else if(l.type==="channels")m=l.channels,y(m);else if(l.type==="channelCreated")E(l.name);else if(l.type==="channelDeleted")d===l.name&&(d=m.find(c=>c!==l.name)||"general",v.innerText=`# ${d}`,u.placeholder=`Message #${d}...`),m=m.filter(c=>c!==l.name),y(m);else if(l.type==="history")p.innerHTML="",l.messages.forEach(c=>g(c));else if(l.type==="message")g(l);else if(l.type==="updateLikes"){const c=document.getElementById("like-"+l.id);c&&(c.innerText=`❤️ ${l.likes}`)}}}function C(){localStorage.clear(),location.reload()}function M(){const e=document.getElementById("new-password").value.trim();if(!e)return alert("Enter a new password!");i.send(JSON.stringify({type:"change_password",user:r,newPass:e})),localStorage.setItem("chatPass",e);const n=document.getElementById("settings-modal");n&&(n.style.display="none")}function T(){const e=new(window.AudioContext||window.webkitAudioContext),n=e.createOscillator();n.connect(e.destination),n.frequency.setValueAtTime(800,e.currentTime),n.start(),n.stop(e.currentTime+.15)}function I(){if(r||(r=document.getElementById("auth-user")?.value?.trim()),!r)return alert("Please enter a username!");localStorage.setItem("chatUsername",r);const e=document.getElementById("login-screen");e&&(e.style.display="none");const n=`ws://${window.location.host}`;i=new WebSocket(n),i.onopen=()=>{i.send(JSON.stringify({type:"join",channel:d}))},i.onmessage=async s=>{const o=s.data instanceof Blob?await s.data.text():s.data,t=JSON.parse(o);if(t.type==="channels")m=t.channels,y(m);else if(t.type==="channelCreated")E(t.name);else if(t.type==="channelDeleted")d===t.name&&(d=m.find(a=>a!==t.name)||"general",v.innerText=`# ${d}`,u.placeholder=`Message #${d}...`),m=m.filter(a=>a!==t.name),y(m);else if(t.type==="history")p.innerHTML="",t.messages.forEach(a=>g(a));else if(t.type==="message")g(t);else if(t.type==="updateLikes"){const a=document.getElementById("like-"+t.id);a&&(a.innerText=`❤️ ${t.likes}`)}}}function E(e,n){d=e,document.querySelectorAll(".channel").forEach(s=>s.classList.remove("active")),n&&n.classList.add("active"),v.innerText=`# ${e}`,u.placeholder=`Message #${e}...`,i&&i.readyState===WebSocket.OPEN&&i.send(JSON.stringify({type:"join",channel:d}))}let w=null;function y(e){const n=document.getElementById("channel-list");n&&(n.innerHTML="",e.forEach(s=>{const o=document.createElement("div");o.className="channel"+(d===s?" active":"");const t=document.createElement("span");if(t.innerText=`# ${s}`,t.style.flex="1",t.onclick=function(){E(s,o)},o.appendChild(t),s!=="general"){const a=document.createElement("span");a.innerText="✕",a.className="channel-delete-btn",a.onclick=function(l){l.stopPropagation(),B(s)},o.appendChild(a)}n.appendChild(o)}))}function x(){const e=document.getElementById("new-channel-name");e&&(e.value="");const n=document.getElementById("add-channel-modal");n&&(n.style.display="flex")}function B(e){w=e;const n=document.getElementById("delete-channel-name");n&&(n.innerText=e);const s=document.getElementById("delete-channel-modal");s&&(s.style.display="flex")}function $(){w&&(i.send(JSON.stringify({type:"deleteChannel",name:w})),w=null);const e=document.getElementById("delete-channel-modal");e&&(e.style.display="none")}function O(){const e=document.getElementById("new-channel-name").value.trim();if(!e)return;i.send(JSON.stringify({type:"createChannel",name:e}));const n=document.getElementById("add-channel-modal");n&&(n.style.display="none")}function b(e){i.send(JSON.stringify({type:"deleteChannel",name:e}))}function g(e){let n;try{n=atob(e.text)}catch{n=e.text}let s=!1;n.includes(`@${r}`)&&(s=!0,e.user!==r&&T());let o="";e.media&&(e.mediaType==="video"?o=`<video src="${e.media}" class="msg-media" controls></video>`:o=`<img src="${e.media}" class="msg-media">`),p.innerHTML+=`
                <div class="msg-block ${s?"highlight":""}" id="msg-${e.id}">
                    <span class="msg-user">${e.user}</span>
                    <div class="msg-text">${n}</div>
                    ${o}
                    <div class="msg-actions">
                        <button class="action-btn" id="like-${e.id}" onclick="likeMessage('${e.id}')">❤️ ${e.likes}</button>
                        <button class="action-btn" onclick="replyTo('${e.user}')">↩️ Reply</button>
                    </div>
                </div>
            `,p.scrollTop=p.scrollHeight}function k(){const e=document.getElementById("new-username");e&&(e.value=r);const n=document.getElementById("settings-modal");n&&(n.style.display="flex")}function L(){const e=document.getElementById("new-username").value.trim();if(e){r=e,localStorage.setItem("chatUsername",r);const n=document.getElementById("settings-modal");n&&(n.style.display="none")}}function N(e){i&&i.send(JSON.stringify({type:"like",channel:d,messageId:e}))}function P(e){u.value=`@${e} `+u.value,u.focus()}document.getElementById("file-upload").addEventListener("change",function(){const e=this.files?.[0];if(!e)return;if(e.size>52428800)return alert("File is too large! Max limit is 50MB.");const n=new FileReader;n.onload=function(s){h=s.target?.result,f=e.type.startsWith("video")?"video":"image",u.placeholder=`[${f} attached] Add a message...`},n.readAsDataURL(e)});u.addEventListener("keypress",function(e){e.key==="Enter"&&(u.value.trim()||h)&&i&&(f==="video"&&(u.placeholder="Uploading video... please wait."),i.send(JSON.stringify({type:"message",channel:d,user:r,text:btoa(u.value),media:h,mediaType:f})),u.value="",u.placeholder=`Message #${d}...`,h=null,f=null,document.getElementById("file-upload").value="")});window.authenticate=S;window.signOut=C;window.changePassword=M;window.joinChat=I;window.switchChannel=E;window.renderChannels=y;window.openAddChannelModal=x;window.openDeleteChannelModal=B;window.confirmDeleteChannel=$;window.createChannel=O;window.deleteChannel=b;window.appendMessage=g;window.openSettings=k;window.saveSettings=L;window.likeMessage=N;window.replyTo=P;
